"use strict";(self.webpackChunkevcc_docs=self.webpackChunkevcc_docs||[]).push([[4515],{38720:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>l});var s=r(85893),i=r(11151);const t={sidebar_position:3},a="Plugins",o={id:"reference/plugins",title:"Plugins",description:"Plugins can be used to integrate various devices and external data sources into evcc. These can be used through the custom value of the type parameter in meter (power meters), charger (charging stations), or vehicle (vehicles).",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/reference/plugins.md",sourceDirName:"reference",slug:"/reference/plugins",permalink:"/en/docs/reference/plugins",draft:!1,unlisted:!1,editUrl:"https://github.com/evcc-io/docs/tree/main/i18n/en/docusaurus-plugin-content-docs/current/reference/plugins.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"modbusproxy",permalink:"/en/docs/reference/configuration/modbusproxy"},next:{title:"Modbus",permalink:"/en/docs/reference/modbus"}},c={},l=[{value:"Modbus (read/write)",id:"modbus-readwrite",level:2},{value:"MQTT (read/write)",id:"mqtt-readwrite",level:2},{value:"HTTP (read/write)",id:"http-readwrite",level:2},{value:"Websocket (read only)",id:"websocket-read-only",level:2},{value:"SMA/Speedwire (read only)",id:"smaspeedwire-read-only",level:2},{value:"Javascript (read/write)",id:"javascript-readwrite",level:2},{value:"Shell Script (read/write)",id:"shell-script-readwrite",level:2},{value:"Const (read only)",id:"const-read-only",level:2},{value:"Calc (read only)",id:"calc-read-only",level:2},{value:"Combined Status (read only)",id:"combined-status-read-only",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"plugins",children:"Plugins"}),"\n",(0,s.jsxs)(n.p,{children:["Plugins can be used to integrate various devices and external data sources into evcc. These can be used through the ",(0,s.jsx)(n.code,{children:"custom"})," value of the ",(0,s.jsx)(n.code,{children:"type"})," parameter in ",(0,s.jsx)(n.a,{href:"/docs/reference/configuration/meters#custom",children:(0,s.jsx)(n.code,{children:"meter"})})," (power meters), ",(0,s.jsx)(n.a,{href:"/docs/reference/configuration/chargers#type",children:(0,s.jsx)(n.code,{children:"charger"})})," (charging stations), or ",(0,s.jsx)(n.a,{href:"/docs/devices/vehicles/#custom",children:(0,s.jsx)(n.code,{children:"vehicle"})})," (vehicles)."]}),"\n",(0,s.jsxs)(n.p,{children:["Plugins allow both ",(0,s.jsx)(n.em,{children:"write access"})," and ",(0,s.jsx)(n.em,{children:"read access"}),". When the plugin is used for ",(0,s.jsx)(n.em,{children:"writing"}),", the data is provided in the ",(0,s.jsx)(n.code,{children:"${var[:format]}"})," format. If ",(0,s.jsx)(n.code,{children:"format"})," is not specified, the data is provided in the default ",(0,s.jsx)(n.code,{children:"%v"})," ",(0,s.jsx)(n.a,{href:"https://golang.org/pkg/fmt/",children:"Go Format"}),". The variables are replaced with their corresponding values before the plugin is executed."]}),"\n",(0,s.jsx)(n.h2,{id:"modbus-readwrite",children:"Modbus (read/write)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"modbus"})," plugin can read data from any Modbus-capable device or SunSpec-compatible inverter. Many power meters are already pre-configured (see ",(0,s.jsx)(n.a,{href:"https://github.com/volkszaehler/mbmd#supported-devices",children:"MBMD Supported Devices"}),"). It is also possible to write Modbus registers to integrate additional charging stations."]}),"\n",(0,s.jsxs)(n.p,{children:["For more details, see the ",(0,s.jsx)(n.a,{href:"modbus",children:"Modbus Documentation"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"mqtt-readwrite",children:"MQTT (read/write)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"mqtt"})," plugin allows reading values via MQTT topics. This is particularly useful for power meters, for example, if they already provide their data via MQTT.\nRefer to ",(0,s.jsx)(n.a,{href:"https://github.com/volkszaehler/mbmd",children:"MBMD"})," for an example of how to get Modbus measurement data into MQTT. The plugin also offers the ability to read or parse JSON data structures using jq-like queries (See ",(0,s.jsx)(n.a,{href:"#http-readwrite",children:"HTTP plugin"}),")."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: mqtt\ntopic: mbmd/sdm1-1/Power\ntimeout: 30s # don't accept values older than timeout\nscale: 0.001 # floating point factor applied to result, e.g. for converting Wh to kWh\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For write access, the data is provided with the ",(0,s.jsx)(n.code,{children:"payload"})," attribute. If this parameter is missing from the configuration, the value is written in the default format."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of writing to a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: mqtt\ntopic: mbmd/charger/maxcurrent\npayload: ${var:%d}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"http-readwrite",children:"HTTP (read/write)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"http"})," plugin performs HTTP calls to read or update data. It also includes the ability to read or parse JSON data structures using jq queries (e.g., for REST APIs)."]}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsxs)(n.p,{children:["XML documents are automatically converted to JSON format internally, which can then be filtered like a native JSON response using jq. Attributes are prefixed with ",(0,s.jsx)(n.code,{children:"attr"}),"."]})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["For testing jq queries, tools like ",(0,s.jsx)(n.a,{href:"https://www.jsonquerytool.com/",children:"https://www.jsonquerytool.com/"})," for JSON queries and ",(0,s.jsx)(n.a,{href:"https://regex101.com/",children:"https://regex101.com/"})," for regular expression tests can be helpful."]})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: http\nuri: https://volkszaehler/api/data/<uuid>.json?from=now\nmethod: GET # default HTTP method\nheaders:\n  - content-type: application/json\nauth: # basic authorisation\n  type: basic\n  user: foo\n  password: bar\ninsecure: false # set to true to trust self-signed certificates\njq: .data.tuples[0][1] # parse response json\nscale: 0.001 # floating point factor applied to result, e.g. for converting kW to W\ntimeout: 10s # timeout in golang duration format, see https://golang.org/pkg/time/#ParseDuration\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of writing to a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"body: %v # only applicable for PUT or POST requests\n"})}),"\n",(0,s.jsx)(n.h2,{id:"websocket-read-only",children:"Websocket (read only)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"websocket"})," plugin provides a WebSocket listener. It also includes the ability to read or parse JSON data structures using jq-like queries. This can be used, for example, to receive data from Volksz\xe4hler's push server."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'source: http\nuri: ws://<volkszaehler host:port>/socket\njq: .data | select(.uuid=="<uuid>") .tuples[0][1] # parse message json\nscale: 0.001 # floating point factor applied to result, e.g. for converting Wh to kWh\ntimeout: 30s # error if no update received in 30 seconds\n'})}),"\n",(0,s.jsx)(n.h2,{id:"smaspeedwire-read-only",children:"SMA/Speedwire (read only)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"sma"})," plugin provides an interface to SMA devices that support the Speedwire protocol."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'source: sma\nuri: 192.168.4.51 # alternative to serial\nserial: 123456 # alternative to uri\nvalue: ActivePowerPlus # ID of value to read\npassword: "0000" # optional (default: 0000)\ninterface: eth0 # optional\nscale: 1 # optional scale factor for value\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Supported values for ",(0,s.jsx)(n.code,{children:"value"})," can be found in the diagnostic output using the ",(0,s.jsx)(n.code,{children:"evcc meter"})," command (with configured SMA ",(0,s.jsx)(n.code,{children:"meter"})," devices)."]}),"\n",(0,s.jsxs)(n.p,{children:["All possible values can be found as constants ",(0,s.jsx)(n.a,{href:"https://gitlab.com/bboehmke/sunny/-/blob/master/values.go#L24",children:"here"})," (use the constant name for ",(0,s.jsx)(n.code,{children:"value"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"javascript-readwrite",children:"Javascript (read/write)"}),"\n",(0,s.jsxs)(n.p,{children:["evcc integrates a Javascript interpreter with the ",(0,s.jsx)(n.a,{href:"https://underscorejs.org",children:"Underscore.js"})," library, which is directly accessible through ",(0,s.jsx)(n.code,{children:"_."}),", e.g., ",(0,s.jsx)(n.code,{children:"_.random(0,5)"}),". The ",(0,s.jsx)(n.code,{children:"js"})," plugin can execute JavaScript code using the ",(0,s.jsx)(n.code,{children:"script"})," parameter. Very helpful for quickly creating prototypes:"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: js\nscript: |\n  var res = 500;\n  2 * res; // returns 1000\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When the ",(0,s.jsx)(n.code,{children:"js"})," plugin is used for writing, the value to be written is passed to the script as a variable:"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of writing to a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"charger:\n  - type: custom\n    maxcurrent:\n      source: js\n      script: |\n        console.log(maxcurrent);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"shell-script-readwrite",children:"Shell Script (read/write)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"script"})," plugin executes external scripts to read or update data. The plugin is useful for integrating any kind of external functionality."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'source: script\ncmd: /bin/bash -c "cat /dev/urandom"\ntimeout: 5s\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of writing to a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: script\ncmd: /home/user/my-script.sh ${enable:%b} # format boolean enable as 0/1\ntimeout: 5s\n"})}),"\n",(0,s.jsx)(n.h2,{id:"const-read-only",children:"Const (read only)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"const"})," plugin returns a constant value. It is suitable, for example, to apply fixed correction values (offsets) to a variable value using the ",(0,s.jsx)(n.code,{children:"calc"})," plugin, or to simulate measurement and status values for testing purposes."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: const\nvalue: -16247\n"})}),"\n",(0,s.jsx)(n.h2,{id:"calc-read-only",children:"Calc (read only)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"calc"})," plugin allows for further processing of multiple individual values mathematically:"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: calc\nadd:\n- source: ...\n  ...\n- source: ...\n  ...\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: calc\nmul:\n- source\n\n: calc\n  sign:\n    source: ... (power)\n  ...\n- source: ... (current)\n  ...\n"})}),"\n",(0,s.jsx)(n.p,{children:"The basic arithmetic operations of addition (add) and multiplication (mul) are supported as operands."}),"\n",(0,s.jsxs)(n.p,{children:["With ",(0,s.jsx)(n.code,{children:"scale: -1"}),", a simple subtraction can be performed, and with ",(0,s.jsx)(n.code,{children:"scale: 0.001"}),", division can be used, for example, to convert kWh to Wh."]}),"\n",(0,s.jsxs)(n.p,{children:["With ",(0,s.jsx)(n.code,{children:"sign:"})," (every positive number becomes +1, every negative number becomes -1, 0 remains 0), signs can be transferred to other values (in conjunction with ",(0,s.jsx)(n.code,{children:"mul"}),'). For example, to transfer the "direction" of power (injection or consumption) to the measured currents.']}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"calc"})," plugin is helpful for:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Summing power values from individual PV strings (addition)"}),"\n",(0,s.jsx)(n.li,{children:"Calculating apparent power from voltage and current (multiplication)"}),"\n",(0,s.jsx)(n.li,{children:"Combining separate power values for import and export into a signed single value (subtraction)"}),"\n",(0,s.jsx)(n.li,{children:"Calculating percentage fill levels (division)"}),"\n",(0,s.jsx)(n.li,{children:"Determining the correct direction of current flow (sign)"}),"\n",(0,s.jsxs)(n.li,{children:["Eliminating known offsets (addition with ",(0,s.jsx)(n.code,{children:"const"})," plugin)"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Constant auxiliary values (e.g., for offsets) can be generated as operands using the ",(0,s.jsx)(n.code,{children:"const"})," plugin."]})}),"\n",(0,s.jsx)(n.h2,{id:"combined-status-read-only",children:"Combined Status (read only)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"combined"})," status plugin is used to convert mixed boolean status values of ",(0,s.jsx)(n.code,{children:"Plugged"})," / ",(0,s.jsx)(n.code,{children:"Charging"})," into an evcc-compatible charging status of A..F. It is used, for example, with the OpenWB MQTT integration."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example of reading from a device"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"source: combined\nplugged:\n  source: mqtt\n  topic: openWB/lp/1/boolPlugStat\ncharging:\n  source: mqtt\n  topic: openWB/lp/1/boolChargeStat\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>a});var s=r(67294);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);